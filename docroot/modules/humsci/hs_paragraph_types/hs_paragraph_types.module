<?php

/**
 * @file
 * hs_paragraph_types.module
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_preprocess_HOOK().
 */
function hs_paragraph_types_preprocess_paragraph(&$variables) {
  if (in_array($variables['paragraph']->bundle(), ['hs_collection', 'hs_priv_collection'])) {
    /** @var \Drupal\paragraphs\ParagraphInterface $paragraph */
    $paragraph = $variables['paragraph'];
    $row_style = $paragraph->get('field_paragraph_style')->getString();
    if (!empty($row_style)) {
      $variables['attributes']['class'][] = 'hs-paragraph-style hs-paragraph-style--' . $row_style;
    }
    $variables['#attached']['library'][] = 'hs_paragraph_types/hs_collection';
  }
}

/**
 * Implements hook_preprocess_HOOK().
 */
function hs_paragraph_types_preprocess_field__field_hs_collection_items(&$variables) {
  /** @var \Drupal\paragraphs\ParagraphInterface $paragraph */
  $paragraph = $variables['element']['#object'];
  $items_per_row = (int) $paragraph->get('field_hs_collection_per_row')
    ->getString();
  $variables['attributes']['class'][] = "item-per-row--$items_per_row";
  $variables['#attached']['library'][] = 'hs_paragraph_types/hs_collection';
}

/**
 * Implements hook_form_alter().
 */
function hs_paragraph_types_field_widget_single_element_paragraphs_form_alter(&$element, &$form_state, $context) {
  // Change the paragraph type label for hs_hero_image embedded in hs_carousel.
  if ($element['#paragraph_type'] === 'hs_hero_image' && $element['#bundle'] === 'hs_carousel') {
    $label = $element['top']['type']['label']['#markup'];
    $new_label = str_replace('full overlay and text', 'text box', $label);
    $element['top']['type']['label']['#markup'] = $new_label;
  }
}

/**
 * Implements hook_field_widget_complete_form_alter().
 */
function hs_paragraph_types_field_widget_complete_paragraphs_form_alter(&$field_widget_complete_form, FormStateInterface $form_state, $context) {
  // Change the add button label for field_hs_carousel_slides
  if ($field_widget_complete_form['widget']['#field_name'] === "field_hs_carousel_slides") {
    $field_widget_complete_form['widget']['add_more']['add_more_button_hs_hero_image']['#value'] = t('Add @type', [
      '@type' => 'Banner image with text box',
    ]);
  }
}
