{#
/**
 * Macro for creating nested menus in the main navigation.
 */
#}
{% macro nav_menu(items, menu_level, class_prefix) %}
  {% import _self as menus %}
  <ul class="{{ class_prefix }}__menu {{ class_prefix }}__menu-lv{{ menu_level }}">
  {% for item in items %}

    {# Link Attribtues #}
    {% set link_attributes = item.attributes %}
    {% set link_attributes = link_attributes.addClass(class_prefix ~ "__link") %}
    {% set link_attributes = link_attributes.setAttribute('href', item.url|render) %}

    {# Item Attributes #}
    {% set list_attributes = create_attribute() %}
    {% set list_attributes = list_attributes.addClass(class_prefix ~ "__item") %}
    {% if item.below is not empty %}
      {% set list_attributes = list_attributes.addClass(class_prefix ~ "__item--parent") %}
    {% endif %}
    {% if item.in_active_trail == true %}
      {% set list_attributes = list_attributes.addClass(class_prefix ~ "__item--active-trail") %}
    {% endif %}
    {% if item.is_active == true %}
      {% set list_attributes = list_attributes.addClass(class_prefix ~ "__item--current") %}
    {% endif %}

    <li{{ list_attributes }}>
      {# This check whether or not there is a URL #}
      {% if item.url.toString() is empty %}
        {#
          If there is no URL (<nolink>) then we need the toggler classes to be
          on the anchor tag. We also don't need the button because the anchor tag
          acts as the button to toggle the nested navigation.
        #}
        {% set link_attributes = link_attributes.addClass('hb-nested-toggler') %}
        <a{{ link_attributes }} id="{{ item.title|replace({' ': ''}) }}{{ menu_level }}" aria-exanded="true" role="button">{{ item.title }}</a>

        {% if item.below %}
          <div class="{{ class_prefix }}__menu-container" aria-labelledby="{{ item.title|replace({' ': ''}) }}{{ menu_level }}">
            {{ menus.nav_menu(item.below, menu_level + 1, class_prefix) }}
          </div>
        {% endif %}
      {% else %}
        {#
          If there is a URL then we use a separate button element to toggle the
          nested navigation and the anchor tag will just act as a link.
        #}
        <a{{ link_attributes }}>{{ item.title }}</a>

        {% if item.below %}
          <button class="{{ class_prefix }}__button hb-nested-toggler" id="{{ item.title|replace({' ': ''}) }}{{ menu_level }}" aria-exanded="true">
            Toggle {{ item.title }}
          </button>
          <div class="{{ class_prefix }}__menu-container" aria-labelledby="{{ item.title|replace({' ': ''}) }}{{ menu_level }}">
            {{ menus.nav_menu(item.below, menu_level + 1, class_prefix) }}
          </div>
        {% endif %}
      {% endif %}
    </li>
  {% endfor %}
  </ul>
{% endmacro %}
