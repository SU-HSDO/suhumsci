name: suhumsci
recipe: drupal8
config:
  webroot: docroot
  php: '7.4'
proxy:
  appserver:
    - africanstudies.suhumsci.loc
    - amstudies.suhumsci.loc
    - anthro_net.suhumsci.loc
    - anthropology.suhumsci.loc
    - antiracismlab.suhumsci.loc
    - archaeology.suhumsci.loc
    - art.suhumsci.loc
    - artexhibitions.suhumsci.loc
    - bingschool.suhumsci.loc
    - biology.suhumsci.loc
    - biologyvirtualshowcase.suhumsci.loc
    - bsurp.suhumsci.loc
    - buddhiststudies.suhumsci.loc
    - ccsre.suhumsci.loc
    - ceas.suhumsci.loc
    - cesta.suhumsci.loc
    - chemistry.suhumsci.loc
    - clas.suhumsci.loc
    - classics.suhumsci.loc
    - cmbprogram.suhumsci.loc
    - cmems.suhumsci.loc
    - cqmd.suhumsci.loc
    - creativewriting.suhumsci.loc
    - creees.suhumsci.loc
    - culture_emotion_lab.suhumsci.loc
    - datasciencemajor.suhumsci.loc
    - dennylab.suhumsci.loc
    - dfetter__humsci.suhumsci.loc
    - dlcl.suhumsci.loc
    - dsresearch.suhumsci.loc
    - duboislab.suhumsci.loc
    - ealc.suhumsci.loc
    - economics.suhumsci.loc
    - em1060.suhumsci.loc
    - english.suhumsci.loc
    - ethicsinsociety.suhumsci.loc
    - facultyaffairs_humsci.suhumsci.loc
    - facultyaffairs_humsci2021.suhumsci.loc
    - feldman.suhumsci.loc
    - feminist.suhumsci.loc
    - finance_humsci.suhumsci.loc
    - francestanford.suhumsci.loc
    - gavin_wright__humsci.suhumsci.loc
    - gender.suhumsci.loc
    - globalcurrents.suhumsci.loc
    - grandtour.suhumsci.loc
    - gus_humsci.suhumsci.loc
    - gus_humsci2021.suhumsci.loc
    - heidi_williams__humsci.suhumsci.loc
    - history.suhumsci.loc
    - hopkinsmarinestation.suhumsci.loc
    - hs_colorful.suhumsci.loc
    - hs_design.suhumsci.loc
    - hs_fcp.suhumsci.loc
    - hs_sandbox.suhumsci.loc
    - hs_testing_sandbox.suhumsci.loc
    - hs_traditional.suhumsci.loc
    - hsbi.suhumsci.loc
    - hshr.suhumsci.loc
    - hsweb_userguide.suhumsci.loc
    - humanbiology.suhumsci.loc
    - humanexperience.suhumsci.loc
    - humanitiescore.suhumsci.loc
    - humanrights.suhumsci.loc
    - impact.suhumsci.loc
    - insidehs.suhumsci.loc
    - internationalrelations.suhumsci.loc
    - iranianstudies.suhumsci.loc
    - iriss.suhumsci.loc
    - islamicstudies.suhumsci.loc
    - it_humsci.suhumsci.loc
    - jewishstudies.suhumsci.loc
    - language.suhumsci.loc
    - linguistics.suhumsci.loc
    - lowe.suhumsci.loc
    - mathematics.suhumsci.loc
    - mcs.suhumsci.loc
    - mediterraneanstudies.suhumsci.loc
    - memorylab.suhumsci.loc
    - morrisoninstitute.suhumsci.loc
    - mrc.suhumsci.loc
    - mrc2021.suhumsci.loc
    - mtl.suhumsci.loc
    - music.suhumsci.loc
    - oconnell.suhumsci.loc
    - philit.suhumsci.loc
    - philosophy.suhumsci.loc
    - physics.suhumsci.loc
    - planning_humsci.suhumsci.loc
    - politicalscience.suhumsci.loc
    - popstudies.suhumsci.loc
    - psychology.suhumsci.loc
    - publicpolicy.suhumsci.loc
    - religiousstudies.suhumsci.loc
    - researchadmin_humsci.suhumsci.loc
    - scl.suhumsci.loc
    - sgs.suhumsci.loc
    - shenlab.suhumsci.loc
    - sitp.suhumsci.loc
    - siw.suhumsci.loc
    - sociology.suhumsci.loc
    - southasia.suhumsci.loc
    - stanfordsciencefellows.suhumsci.loc
    - starlab.suhumsci.loc
    - statistics.suhumsci.loc
    - sts.suhumsci.loc
    - suac.suhumsci.loc
    - swshumsci.suhumsci.loc
    - swshumsci_sandbox.suhumsci.loc
    - symsys.suhumsci.loc
    - tessier_lavigne_lab.suhumsci.loc
    - texttechnologies.suhumsci.loc
    - urbanstudies.suhumsci.loc
    - west.suhumsci.loc
    - womensleadership.suhumsci.loc
services:
  appserver:
    build:
      - composer install && /app/vendor/bin/blt blt:init:settings
      - find /app/docroot/sites/ -name local.settings.php | xargs -I {} sed -i "s/'username' => 'root'/'username' => 'drupal'/g" {}
      - find /app/docroot/sites/ -name local.settings.php | xargs -I {} sed -i "s/'password' => 'password'/'password' => 'drupal'/g" {}
      - find /app/docroot/sites/ -name local.settings.php | xargs -I {} sed -i "s/'host' => 'localhost'/'host' => 'database'/g" {}
      - cp /app/lando/lando.sites.php /app/docroot/sites/local.sites.php

    ssl: true
  database: # Override the database that comes in the drupal8
    build_as_root:
      # Create extra databases.
      - mysql -uroot -e "GRANT ALL PRIVILEGES ON *.* TO 'drupal'@'%' IDENTIFIED by 'drupal';"
    creds:  # recipe and use it for the /sites/default site.
      user: drupal
      password: drupal
      database: drupal
  chromedriver:
    type: compose
    services:
      image: robcherry/docker-chromedriver:latest
      expose:
        - "4444"
      environment:
        CHROMEDRIVER_WHITELISTED_IPS: ""
        CHROMEDRIVER_URL_BASE: "/wd/hub"
      security_opt:
        - seccomp:unconfined
      command: ["/usr/local/bin/supervisord", "-c", "/etc/supervisord.conf"]
tooling:
  blt:
    service: appserver
    cmd: /app/vendor/bin/blt
  git:
    service: appserver

